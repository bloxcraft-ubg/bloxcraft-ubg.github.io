<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloxcraft UBG - Browse Mode</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #fff;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .tabs {
    display: flex;
    background: linear-gradient(90deg, #4facfe, #00f2fe);
    padding: 5px;
    overflow-x: auto;
  }
  .tab {
    background: rgba(255,255,255,0.2);
    padding: 10px 15px;
    margin-right: 5px;
    border-radius: 5px;
    cursor: pointer;
    white-space: nowrap;
  }
  .tab.active {
    background: rgba(255,255,255,0.5);
    font-weight: bold;
  }
  .tab-close {
    margin-left: 8px;
    cursor: pointer;
    font-weight: bold;
  }
  .controls {
    display: flex;
    padding: 10px;
    background: rgba(0,0,0,0.3);
    align-items: center;
  }
  .url-bar {
    flex: 1;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #fff;
    padding: 8px 12px;
    border-radius: 5px;
    font-size: 14px;
    pointer-events: none; /* Not editable */
  }
  .refresh-btn {
    margin-left: 10px;
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background: #4facfe;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
  }
  iframe {
    flex: 1;
    border: none;
    width: 100%;
  }
  .add-tab {
    font-size: 20px;
    padding: 0 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="tabs" id="tabs">
  <!-- Tabs will be dynamically added -->
  <div class="add-tab" id="addTab">+</div>
</div>

<div class="controls">
  <input type="text" id="urlBar" class="url-bar" value="bloxcraft://newtab" readonly>
  <button class="refresh-btn" id="refreshBtn">⟳</button>
</div>

<iframe id="browserFrame" src="/assets/home/newtab/index.html"></iframe>

<script>
  const tabsContainer = document.getElementById('tabs');
  const addTabBtn = document.getElementById('addTab');
  const urlBar = document.getElementById('urlBar');
  const browserFrame = document.getElementById('browserFrame');
  const refreshBtn = document.getElementById('refreshBtn');

  let tabs = [];
  let currentTabId = 0;
  let tabCount = 0;

  const defaultPages = {
    '/': '/assets/home/index.html',
    '/games': '/assets/games/index.html',
    '/featured-games': '/assets/featured-games/index.html',
    '/assets/home/newtab/index.html': '/assets/home/newtab/index.html'
  };

  function createTab(src, label) {
    const tabId = tabCount++;
    const tab = { id: tabId, src: src, label: label || "New Tab" };
    tabs.push(tab);

    const tabElem = document.createElement('div');
    tabElem.className = 'tab';
    tabElem.id = 'tab-' + tabId;
    tabElem.innerHTML = `${tab.label}<span class="tab-close">×</span>`;
    tabsContainer.insertBefore(tabElem, addTabBtn);

    tabElem.addEventListener('click', (e) => {
      if (e.target.classList.contains('tab-close')) {
        closeTab(tabId);
      } else {
        switchTab(tabId);
      }
    });

    switchTab(tabId);
  }

  function switchTab(id) {
    currentTabId = id;
    const tab = tabs.find(t => t.id === id);
    browserFrame.src = tab.src;
    urlBar.value = getBloxcraftURL(tab.src);
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    const activeTabElem = document.getElementById('tab-' + id);
    if (activeTabElem) activeTabElem.classList.add('active');
  }

  function closeTab(id) {
    const index = tabs.findIndex(t => t.id === id);
    if (index > -1) {
      tabs.splice(index, 1);
      const tabElem = document.getElementById('tab-' + id);
      if (tabElem) tabElem.remove();
      if (currentTabId === id && tabs.length > 0) {
        switchTab(tabs[0].id);
      } else if (tabs.length === 0) {
        createTab('/assets/home/newtab/index.html', 'New Tab');
      }
    }
  }

  function getBloxcraftURL(src) {
    for (const [key, val] of Object.entries(defaultPages)) {
      if (val === src) {
        return 'bloxcraft://' + (key === '/assets/home/newtab/index.html' ? 'newtab' : key.replace('/', '') || 'home');
      }
    }
    return src;
  }

  addTabBtn.addEventListener('click', () => {
    createTab('/assets/home/newtab/index.html', 'New Tab');
  });

  refreshBtn.addEventListener('click', () => {
    const tab = tabs.find(t => t.id === currentTabId);
    if (tab) browserFrame.src = tab.src;
  });

  // Intercept clicks inside iframe
  browserFrame.addEventListener('load', () => {
    try {
      const iframeDoc = browserFrame.contentDocument || browserFrame.contentWindow.document;
      iframeDoc.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', (e) => {
          const href = link.getAttribute('href');
          if (!href) return;
          if (href.startsWith('https://') || href.startsWith('http://')) {
            window.open(href, '_blank');
            e.preventDefault();
          } else {
            // Navigate inside iframe
            browserFrame.src = href;
            urlBar.value = getBloxcraftURL(href);
            e.preventDefault();
          }
        });
      });
    } catch(err) {
      // Cross-origin, ignore
    }
  });

  // Initialize first tab
  createTab('/assets/home/newtab/index.html', 'New Tab');

</script>
</body>
</html>
