<!-- Copyright (c) Bloxcraft Studios 2025 -->
<!-- NEW TAB ONLY WORKS ON PROXY -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bloxcraft UBG - Proxy - New Tab</title>
<link rel="shortcut icon" type="image/png" href="/bloxcraft.png">
<style>
body {
  color: white;
  background: linear-gradient(to bottom right,#1a1a1a,#3333cc);
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 30px;
  margin: 0;
  height: 100vh;
}
h1 { font-size: 48px; margin-bottom: 20px; text-align: center; }
#search-bar { display: flex; margin-bottom: 20px; }
#search-bar input {
  width: 400px;
  padding: 12px 20px;
  font-size: 16px;
  border-radius: 8px 0 0 8px;
  border: none;
  outline: none;
}
#search-bar button {
  padding: 12px 20px;
  font-size: 16px;
  background: linear-gradient(to bottom,#0077c2,#005f9c);
  border: none;
  border-radius: 0 8px 8px 0;
  cursor: pointer;
  color: white;
}
#search-bar button:hover { background: linear-gradient(to bottom,#0088e0,#006eb5); }

.nav-bar {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
}
.nav-bar button {
  padding: 10px 15px;
  font-size: 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  color: white;
}
#home { background: linear-gradient(to bottom,#aa33ff,#8800cc); }
#home:hover { background: linear-gradient(to bottom,#bb55ff,#9933dd); }
#back { background: linear-gradient(to bottom,#5555ff,#3333cc); }
#back:hover { background: linear-gradient(to bottom,#6666ff,#4444cc); }
#forward { background: linear-gradient(to bottom,#00cc66,#009944); }
#forward:hover { background: linear-gradient(to bottom,#33dd77,#00aa55); }
#refresh { background: linear-gradient(to bottom,#ff9933,#cc6600); }
#refresh:hover { background: linear-gradient(to bottom,#ffaa55,#dd7700); }

iframe#viewer {
  width: 90%;
  height: 60vh;
  border: 1px solid #ccc;
  margin-top: 12px;
}
.app-row {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  padding: 10px;
  max-width: 90%;
}
.app-row::-webkit-scrollbar { display: none; }
.app-btn {
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(255,255,255,0.1);
  border-radius: 15px;
  padding: 15px;
  width: 100px;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}
.app-btn:hover { background: rgba(255,255,255,0.25); transform: scale(1.1); }
.app-btn img { width: 60px; height: 60px; margin-bottom: 10px; }
.app-btn span { font-size: 14px; text-align: center; }
</style>
</head>
<body>
<h1>Bloxcraft UBG New Tab</h1>

<div id="search-bar">
  <input id="search" placeholder="Type a URL or search term..." />
  <button id="search-btn">Go ➤</button>
</div>

<div class="nav-bar">
  <button id="home">⌂</button>
  <button id="back">⬅</button>
  <button id="forward">➡</button>
  <button id="refresh">⟳</button>
</div>

<div class="app-row" id="appRow"></div>
<iframe id="viewer"></iframe>

<script>
const WORKER_URLS = [
  'https://school-static.sweet-dawn-d933.workers.dev/',
  'https://school-static.bs-bloxcraft.workers.dev/',
  'https://school-static.bs-minecraft-pe.workers.dev/'
];

const apps = [
  { name: 'YouTube', url: 'https://www.youtube.com', icon: 'https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg' },
  { name: 'Google', url: 'https://www.google.com', icon: 'https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg' },
  { name: 'Discord', url: 'https://discord.com', icon: 'https://cdn.prod.website-files.com/6257adef93867e50d84d30e2/67d00cf7266d2c75571aebde_Example.svg' }
];

const appRow = document.getElementById('appRow');
const iframe = document.getElementById('viewer');
const searchInput = document.getElementById('search');
const historyStack = [];
const forwardStack = [];

// Add app buttons
apps.forEach(app => {
  const btn = document.createElement('div');
  btn.className = 'app-btn';
  btn.innerHTML = `<img src="${app.icon}" alt="${app.name}"><span>${app.name}</span>`;
  btn.addEventListener('click', () => openInProxy(app.url));
  appRow.appendChild(btn);
});

// Format input into URL or Google search
function formatUrl(input) {
  if(!input) return '';
  input = input.trim();
  if(input.startsWith('bloxcraft://newtab')) return 'https://bloxcraft-ubg.pages.dev/proxy/new-tab/';
  if(input.startsWith('http://') || input.startsWith('https://')) return input;
  return 'https://www.google.com/search?q=' + encodeURIComponent(input);
}

// Find a working worker
async function tryWorkers(url) {
  for(const worker of WORKER_URLS) {
    try {
      const test = await fetch(`${worker}?url=${encodeURIComponent(url)}`, { method:'HEAD' });
      if(test.ok) return worker;
    } catch(e) { console.log(`Worker failed: ${worker}`, e); }
  }
  return null;
}

// Load in proxy iframe
async function openInProxy(input, pushHistory=true) {
  const url = formatUrl(input);
  const worker = await tryWorkers(url);
  if(!worker) { alert('ERROR: All proxy stations are blocked.'); return; }
  iframe.src = `${worker}?url=${encodeURIComponent(url)}`;
  if(pushHistory) { historyStack.push({url, worker}); forwardStack.length = 0; }
}

// Search bar events
document.getElementById('search-btn').addEventListener('click', () => openInProxy(searchInput.value));
searchInput.addEventListener('keydown', e => { if(e.key==='Enter') openInProxy(searchInput.value); });

// Navigation buttons
document.getElementById('home').addEventListener('click', () => openInProxy('bloxcraft://newtab'));
document.getElementById('back').addEventListener('click', () => {
  if(historyStack.length <= 1) return;
  const current = historyStack.pop();
  forwardStack.push(current);
  const previous = historyStack[historyStack.length-1];
  iframe.src = `${previous.worker}?url=${encodeURIComponent(previous.url)}`;
});
document.getElementById('forward').addEventListener('click', () => {
  if(!forwardStack.length) return;
  const next = forwardStack.pop();
  iframe.src = `${next.worker}?url=${encodeURIComponent(next.url)}`;
  historyStack.push(next);
});
document.getElementById('refresh').addEventListener('click', () => {
  if(!historyStack.length) return;
  const current = historyStack[historyStack.length-1];
  iframe.src = `${current.worker}?url=${encodeURIComponent(current.url)}`;
});

// Initial load: New Tab in proxy
window.addEventListener('DOMContentLoaded', () => openInProxy('bloxcraft://newtab', false));

</script>
</body>
</html>
